<!DOCTYPE html>
<html lang="en-UK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKILLSCONNECT LMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Login Modal Transitions */
        #loginModal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #loginModal.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* Sidebar Transitions */
        .sidebar {
            transition: all 0.3s ease;
            width: 256px; /* Default width for desktop */
            flex-shrink: 0; /* Prevent shrinking */
        }
        .sidebar.collapsed {
            width: 70px;
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        .sidebar.collapsed .logo-text {
            display: none;
        }
        .sidebar.collapsed .user-info {
            display: none;
        }
        .sidebar.collapsed .sidebar-item {
            justify-content: center; /* Center icons when collapsed */
        }
        /* Adjust content area margin based on sidebar state */
        .content-area {
            transition: margin-left 0.3s ease;
            margin-left: 256px; /* Offset for default sidebar width */
            flex-grow: 1;
        }
        .sidebar.collapsed + .content-area { /* Apply margin change when sidebar is collapsed */
            margin-left: 70px;
        }

        /* Mobile specific sidebar */
        @media (max-width: 1023px) { /* Tailind's lg breakpoint is 1024px */
            .sidebar {
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
                box-shadow: 0 0 15px rgba(0,0,0,0.2); /* Add shadow for mobile drawer effect */
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .content-area {
                margin-left: 0 !important; /* No left margin on mobile */
            }
            .mobile-menu-btn {
                display: block; /* Show mobile menu button */
            }
            #toggleSidebar { /* Hide desktop toggle button on mobile */
                display: none;
            }
        }
        @media (min-width: 1024px) {
            .mobile-menu-btn { /* Hide mobile menu button on desktop */
                display: none;
            }
        }


        /* Course card hover effect */
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        /* Notification badge positioning */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
        }
        /* Dropdown menu hidden by default, shown by JS */
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            z-index: 1000;
        }
        /* Active sidebar item styling */
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 8px; /* Rounded corners for sidebar items */
            color: #E0E7FF; /* indigo-100 */
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .sidebar-item:hover {
            background-color: #4338CA; /* indigo-700 */
            color: #fff;
        }
        .sidebar-item.active {
            background-color: #4F46E5; /* indigo-600 */
            color: #fff;
            font-weight: 600;
        }
        .sidebar-item i {
            width: 24px; /* Ensure icon has consistent width */
            text-align: center;
        }

        /* Content section hidden by default */
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }

        /* Message Modal specific styles */
        #messageModal, #addUserModal, #pdfViewerModal, #assignStudentsModal {
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(20px);
        }
        #messageModal.show, #addUserModal.show, #pdfViewerModal.show, #assignStudentsModal.show {
            opacity: 1;
            transform: translateY(0);
        }
        #messageModal.hidden, #addUserModal.hidden, #pdfViewerModal.hidden, #assignStudentsModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <!-- Message Modal -->
    <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="messageModalTitle">Notification</h3>
            <p class="text-gray-700 mb-6" id="messageModalContent"></p>
            <div class="flex justify-end">
                <button
                    onclick="hideMessageModal()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add New User</h3>
            <form id="addUserForm">
                <div class="mb-4 text-center">
                    <label class="block text-gray-700 text-sm font-medium mb-2">User Picture</label>
                    <img id="userPicturePreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover" src="https://placehold.co/96x96/E0E7FF/4F46E5?text=UP" alt="User Picture">
                    <input type="file" id="userPictureInput" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100"/>
                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userNameInput">Name</label>
                    <input id="userNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's name">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userSurnameInput">Surname</label>
                    <input id="userSurnameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's surname">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userEmailInput">Email Address</label>
                    <input id="userEmailInput" type="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's email">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userIDNumberInput">ID Number</label>
                    <input id="userIDNumberInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's ID number">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="companyNameInput">Company Name</label>
                    <input id="companyNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter company name">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userPasswordInput">Password</label>
                    <input id="userPasswordInput" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter a password">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="newUserRoleSelect">Select Role</label>
                    <select id="newUserRoleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="administrator">Administrator</option>
                        <option value="training_manager">Training Manager</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideAddUserModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                        Add User
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <i class="fas fa-graduation-cap text-indigo-600 text-5xl mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">Welcome to SKILLSCONNECT LMS</h2>
                <p class="text-gray-600">Please sign in to continue</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="loginUsernameInput">Username</label>
                    <input id="loginUsernameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your username">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="loginPasswordInput">Password</label>
                    <input id="loginPasswordInput" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your password">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userRoleSelect">Select Role</label>
                    <select id="userRoleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="administrator">Administrator</option>
                        <option value="training_manager">Training Manager</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Sign In
                </button>
                <div class="mt-4 text-center text-sm text-gray-600">
                    <a href="#" class="text-indigo-600 hover:text-indigo-800">Forgot password?</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for viewing PDF (simulated) -->
    <div id="pdfViewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-2xl w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="pdfModalTitle">View Document</h3>
            <div class="mb-4 h-64 overflow-y-auto border border-gray-300 p-2 rounded-md bg-gray-50 text-gray-700">
                <p>Simulating PDF content here for: <span id="simulatedPdfContentFileName" class="font-medium"></span></p>
                <p class="mt-2 text-sm text-gray-600">In a real application, an embedded PDF viewer (e.g., using PDF.js or a Google Docs Viewer iframe) would display the document here.</p>
                <p class="mt-2 text-xs text-gray-500">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                <p class="mt-2 text-xs text-gray-500">Section 2: Detailed analysis and findings. Proin eget tortor risus. Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui.</p>
                <p class="mt-2 text-xs text-gray-500">Conclusion: Summary of key takeaways and next steps. Cras ultricies ligula sed magna dictum porta. Nulla porttitor accumsan tincidunt. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Donec velit neque, auctor sit amet aliquam vel, ullamcorper sit amet ligula.</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button
                    onclick="hidePdfViewerModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Close
                </button>
                <button
                    id="markAsReadBtn"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Mark as Read
                </button>
            </div>
        </div>
    </div>

    <!-- Assign Students Modal -->
    <div id="assignStudentsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="assignStudentsModalTitle">Assign Students to Programme</h3>
            <div class="mb-4 max-h-60 overflow-y-auto border border-gray-300 rounded-md p-2">
                <p id="noStudentsAvailable" class="text-gray-500 text-sm text-center py-4 hidden">No students available. Add students via User Management first.</p>
                <div id="assignStudentsList" class="space-y-2">
                    <!-- Student checkboxes will be loaded here -->
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="hideAssignStudentsModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                    Cancel
                </button>
                <button type="button" id="saveAssignedStudentsBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                    Save Assignments
                </button>
            </div>
        </div>
    </div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-indigo-800 text-white flex flex-col">
            <!-- Logo -->
            <div class="p-4 flex items-center justify-between border-b border-indigo-700">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-2xl mr-3"></i>
                    <span class="logo-text text-xl font-bold">SKILLSCONNECT LMS</span>
                </div>
                <button id="toggleSidebar" class="text-white focus:outline-none hidden lg:block">
                    <i class="fas fa-bars"></i>
                </button>
                <button id="mobileCloseSidebarBtn" class="text-white focus:outline-none lg:hidden">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- User Info -->
            <div class="user-info p-4 flex items-center border-b border-indigo-700">
                <img src="https://placehold.co/40x40/FF5733/FFFFFF?text=U" alt="User" class="w-10 h-10 rounded-full mr-3">
                <div>
                    <div class="font-semibold" id="sidebarUsername"></div>
                    <div class="text-xs text-indigo-300" id="sidebarUserrole"></div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto">
                <div id="adminNav" class="nav-section">
                    <div class="p-4 text-xs uppercase text-indigo-400 font-semibold sidebar-text">Administration</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="user-management">
                        <i class="fas fa-users mr-3"></i>
                        <span class="sidebar-text">User Management</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="programme-management">
                        <i class="fas fa-sitemap mr-3"></i>
                        <span class="sidebar-text">Programme Management</span>
                    </a>
                     <a href="#" class="sidebar-item" data-section="user-programme-assignment">
                        <i class="fas fa-user-tag mr-3"></i>
                        <span class="sidebar-text">Assign Students</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="course-content">
                        <i class="fas fa-file-upload mr-3"></i>
                        <span class="sidebar-text">Course Content Overview</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="reports">
                        <i class="fas fa-chart-bar mr-3"></i>
                        <span class="sidebar-text">Reports</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="system-settings">
                        <i class="fas fa-cog mr-3"></i>
                        <span class="sidebar-text">System Settings</span>
                    </a>
                </div>
                
                <div id="trainingManagerNav" class="nav-section hidden">
                    <div class="p-4 text-xs uppercase text-indigo-400 font-semibold sidebar-text">Management</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-courses">
                        <i class="fas fa-book mr-3"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="user-programme-assignment">
                        <i class="fas fa-user-tag mr-3"></i>
                        <span class="sidebar-text">Assign Students</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="assignments">
                        <i class="fas fa-tasks mr-3"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="grades">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        <span class="sidebar-text">Gradebook</span>
                    </a>
                </div>
                
                <div id="studentNav" class="nav-section hidden">
                    <div class="p-4 text-xs uppercase text-indigo-400 font-semibold sidebar-text">Learning</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="enrolled-courses">
                        <i class="fas fa-book mr-3"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="student-assignments">
                        <i class="fas fa-tasks mr-3"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-grades">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        <span class="sidebar-text">My Grades</span>
                    </a>
                </div>
                
                <div class="p-4 text-xs uppercase text-indigo-400 font-semibold sidebar-text">Account</div>
                <a href="#" class="sidebar-item" data-section="profile">
                    <i class="fas fa-user mr-3"></i>
                    <span class="sidebar-text">Profile</span>
                </a>
                <a href="#" class="sidebar-item" data-section="messages">
                    <i class="fas fa-envelope mr-3"></i>
                    <span class="sidebar-text">Messages</span>
                    <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
                <a href="#" class="sidebar-item" data-section="notifications">
                    <i class="fas fa-bell mr-3"></i>
                    <span class="sidebar-text">Notifications</span>
                    <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
                <a href="#" class="sidebar-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span class="sidebar-text">Logout</span>
                </a>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div id="contentArea" class="content-area flex-1 overflow-y-auto">
            <!-- Top Navigation -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center">
                        <button id="mobileMenuBtn" class="mobile-menu-btn text-gray-600 mr-4 focus:outline-none lg:hidden">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 class="text-xl font-semibold text-gray-800" id="pageTitle">Dashboard</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="text-gray-600 focus:outline-none">
                                <i class="fas fa-search text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="relative dropdown">
                            <button type="button" class="text-gray-600 focus:outline-none relative" onclick="toggleDropdown(this)">
                                <i class="fas fa-bell text-xl"></i>
                                <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                            </button>
                            <div class="dropdown-menu hidden mt-2 w-64 bg-white rounded-md shadow-lg py-1">
                                <div class="px-4 py-2 border-b border-gray-200">
                                    <h3 class="text-sm font-semibold text-gray-800">Notifications</h3>
                                </div>
                                <p class="block px-4 py-2 text-sm text-gray-700">No new notifications.</p>
                                <div class="px-4 py-2 border-t border-gray-200">
                                    <a href="#" class="text-xs text-indigo-600 hover:underline">View all notifications</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative dropdown">
                            <button type="button" class="flex items-center focus:outline-none" onclick="toggleDropdown(this)">
                                <img src="https://placehold.co/32x32/FF5733/FFFFFF?text=U" alt="User" class="w-8 h-8 rounded-full">
                                <span class="ml-2 text-gray-700 hidden md:inline" id="topNavUsername">Admin User</span>
                                <i class="fas fa-chevron-down ml-1 text-gray-600 text-xs hidden md:inline"></i>
                            </button>
                            <div class="dropdown-menu hidden mt-2 w-48 bg-white rounded-md shadow-lg py-1">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="profile">
                                    <i class="fas fa-user mr-2"></i> Profile
                                </a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="system-settings">
                                    <i class="fas fa-cog mr-2"></i> Settings
                                </a>
                                <div class="border-t border-gray-200"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="topLogoutBtn">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="p-6 flex-1 overflow-y-auto">
                <!-- Dashboard Content -->
                <div id="dashboardContent" class="content-section active">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Welcome back, <span id="greetingName"></span>!</h2>
                        <p class="text-gray-600">Here's what's happening in your LMS today.</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                                    <i class="fas fa-book text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Total Courses</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="totalCourses">0</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Total Students</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="totalStudents">0</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                                    <i class="fas fa-star text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Average Course Rating</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="studentGPA">N/A</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Recent Activity</h3>
                            <a href="#" class="text-sm text-indigo-600 hover:underline">View all</a>
                        </div>
                        <div class="space-y-4" id="recentActivityList">
                            <p class="text-gray-500 text-sm">No recent activity to display.</p>
                        </div>
                    </div>
                    
                    <!-- Courses/Assignments Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Courses -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800" id="coursesTitle">All Courses</h3>
                                <a href="#" class="text-sm text-indigo-600 hover:underline">View all</a>
                            </div>
                            <div class="space-y-4" id="coursesList">
                                <p class="text-gray-500 text-sm">No courses to display. Click "Course Content & Creation" to add new courses.</p>
                            </div>
                        </div>
                        
                        <!-- Assignments -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800" id="assignmentsTitle">Recent Assignments</h3>
                                <a href="#" class="text-sm text-indigo-600 hover:underline">View all</a>
                            </div>
                            <div class="space-y-4" id="assignmentsList">
                                <p class="text-gray-500 text-sm">No recent assignments to display.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Management Content -->
                <div id="user-managementContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">User Management</h2>
                        <p class="text-gray-600">Manage all users in the system</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800">All Users</h3>
                            <button id="addUserBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm hover:bg-indigo-700 focus:outline-none">
                                <i class="fas fa-plus mr-1"></i> Add User
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Number</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="userTableBody">
                                    <tr>
                                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No users to display. Click "Add User" to add new entries.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="usersShowingCount">0</span> to <span class="font-medium" id="usersTotalCountDisplay">0</span> of <span class="font-medium" id="usersTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Programme Management Content (formerly part of Course Management) -->
                <div id="programme-managementContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Programme Management</h2>
                        <p class="text-gray-600">Create, edit, and manage your learning programmes.</p>
                    </div>
                    <!-- Create New Programme Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Programme</h3>
                        <form id="createProgrammeForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="programmeNameInput">Programme Name</label>
                                <input id="programmeNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Software Development Bootcamp">
                            </div>
                            <div class="mb-4 text-center">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Programme Picture (Optional)</label>
                                <img id="programmePicturePreview" class="inline-block h-32 w-32 rounded-lg mb-3 object-cover border border-gray-300" src="https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image" alt="Programme Image">
                                <input type="file" id="programmePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-blue-50 file:text-blue-700
                                    hover:file:bg-blue-100"/>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Link Courses to Programme</label>
                                <div id="linkedCoursesSelection" class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                                    <p id="noCoursesAvailableForProgramme" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>
                                </div>
                            </div>

                            <div class="flex justify-end mt-6 space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none" onclick="resetProgrammeForm()">
                                    Reset Form
                                </button>
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                                    Create Programme
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Programmes Table -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Existing Programmes</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Programme Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Linked Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned Students</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="existingProgrammesTableBody">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes to display. Create a new programme above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="programmesShowingCount">0</span> to <span class="font-medium" id="programmesTotalCountDisplay">0</span> of <span class="font-medium" id="programmesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Assignment to Programmes Content (New Section) -->
                <div id="user-programme-assignmentContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Assign Students to Programmes</h2>
                        <p class="text-gray-600">Assign students to existing learning programmes.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Available Programmes for Assignment</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Programme Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Linked Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned Students</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="programmesForAssignmentTableBody">
                                    <tr>
                                        <td colspan="4" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes available for assignment. Create programmes first.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="assignProgrammesShowingCount">0</span> to <span class="font-medium" id="assignProgrammesTotalCountDisplay">0</span> of <span class="font-medium" id="assignProgrammesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Course Content & Creation Content (for Admin Overview) -->
                <div id="course-contentContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Course Content Overview</h2>
                    <p class="text-gray-600 mb-6">View and manage all courses in the system.</p>

                    <!-- Available Course Materials (All Existing Courses Table) -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">All Existing Courses (for Admin Review)</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Video</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Questions</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Creator</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="allExistingCoursesTableBody">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses to display. Create a new course in "My Courses".</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="allCoursesShowingCount">0</span> to <span class="font-medium" id="allCoursesTotalCountDisplay">0</span> of <span class="font-medium" id="allCoursesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="reportsContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Reports</h2>
                        <p class="text-gray-600">Generate various reports on user and course data.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Generate New Report</h3>
                        <form id="reportGenerationForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportStartDate">Start Date</label>
                                <input type="date" id="reportStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportEndDate">End Date</label>
                                <input type="date" id="reportEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportUserStatus">User Type / Status</label>
                                <select id="reportUserStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">All Users</option>
                                    <option value="active">Active Users</option>
                                    <option value="deactivated">Inactive Users</option>
                                    <option value="student">Students Only</option>
                                    <option value="training_manager">Training Managers Only</option>
                                    <option value="administrator">Administrators Only</option>
                                </select>
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportCourseSelect">Select Course (Optional)</label>
                                <select id="reportCourseSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">All Courses</option>
                                    <!-- Courses will be dynamically loaded here -->
                                </select>
                            </div>
                            <div class="col-span-full flex justify-end mt-4">
                                <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    Generate Report
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Report Results</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Number</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Enrolled Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completed Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours Spent</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="reportResultsTableBody">
                                    <tr>
                                        <td colspan="9" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No report generated. Use the filters above and click "Generate Report".</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="reportShowingCount">0</span> to <span class="font-medium" id="reportTotalCountDisplay">0</span> of <span class="font-medium" id="reportTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- System Settings Content -->
                <div id="system-settingsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">System Settings</h2>
                    <p class="text-gray-600 mb-6">Configure general LMS settings.</p>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">General Settings</h3>
                        </div>
                        <div class="p-6">
                            <form id="generalSettingsForm">
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="systemNameInput">System Name</label>
                                    <input type="text" id="systemNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., SKILLSCONNECT LMS">
                                </div>
                                <div class="mb-4 text-center">
                                    <label class="block text-gray-700 text-sm font-medium mb-2">System Logo (Optional)</label>
                                    <img id="systemLogoPreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover border border-gray-300" src="https://placehold.co/96x96/ADD8E6/00008B?text=LMS" alt="System Logo">
                                    <input type="file" id="systemLogoInput" accept="image/*" class="block w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-md file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-blue-50 file:text-blue-700
                                        hover:file:bg-blue-100"/>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="defaultTimezoneSelect">Default Timezone</label>
                                    <select id="defaultTimezoneSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="UTC-12">UTC-12:00 (Baker Island)</option>
                                        <option value="UTC-11">UTC-11:00 (Niue, Samoa)</option>
                                        <option value="UTC-10">UTC-10:00 (Hawaii)</option>
                                        <option value="UTC-9:30">UTC-09:30 (Marquesas Islands)</option>
                                        <option value="UTC-9">UTC-09:00 (Alaska)</option>
                                        <option value="UTC-8">UTC-08:00 (Pacific Time - US & Canada)</option>
                                        <option value="UTC-7">UTC-07:00 (Mountain Time - US & Canada)</option>
                                        <option value="UTC-6">UTC-06:00 (Central Time - US & Canada)</option>
                                        <option value="UTC-5">UTC-05:00 (Eastern Time - US & Canada)</option>
                                        <option value="UTC-4">UTC-04:00 (Atlantic Time - Canada)</option>
                                        <option value="UTC-3:30">UTC-03:30 (Newfoundland)</option>
                                        <option value="UTC-3">UTC-03:00 (Brasilia, Buenos Aires)</option>
                                        <option value="UTC-2">UTC-02:00 (Mid-Atlantic)</option>
                                        <option value="UTC-1">UTC-01:00 (Azores)</option>
                                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                                        <option value="UTC+1">UTC+01:00 (Central European Time)</option>
                                        <option value="UTC+2" selected>UTC+02:00 (South African Standard Time)</option>
                                        <option value="UTC+3">UTC+03:00 (Moscow, Nairobi)</option>
                                        <option value="UTC+3:30">UTC+03:30 (Tehran)</option>
                                        <option value="UTC+4">UTC+04:00 (Dubai, Baku)</option>
                                        <option value="UTC+4:30">UTC+04:30 (Kabul)</option>
                                        <option value="UTC+5">UTC+05:00 (Islamabad, Tashkent)</option>
                                        <option value="UTC+5:30">UTC+05:30 (Mumbai, Kolkata)</option>
                                        <option value="UTC+5:45">UTC+05:45 (Kathmandu)</option>
                                        <option value="UTC+6">UTC+06:00 (Dhaka, Almaty)</option>
                                        <option value="UTC+6:30">UTC+06:30 (Yangon)</option>
                                        <option value="UTC+7">UTC+07:00 (Bangkok, Hanoi)</option>
                                        <option value="UTC+8">UTC+08:00 (Beijing, Perth)</option>
                                        <option value="UTC+8:45">UTC+08:45 (Eucla)</option>
                                        <option value="UTC+9">UTC+09:00 (Tokyo, Seoul)</option>
                                        <option value="UTC+9:30">UTC+09:30 (Adelaide, Darwin)</option>
                                        <option value="UTC+10">UTC+10:00 (Sydney, Melbourne)</option>
                                        <option value="UTC+10:30">UTC+10:30 (Lord Howe Island)</option>
                                        <option value="UTC+11">UTC+11:00 (Solomon Islands)</option>
                                        <option value="UTC+12">UTC+12:00 (Fiji, Auckland)</option>
                                        <option value="UTC+12:45">UTC+12:45 (Chatham Islands)</option>
                                        <option value="UTC+13">UTC+13:00 (Tonga)</option>
                                        <option value="UTC+14">UTC+14:00 (Kiribati)</option>
                                    </select>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="systemLanguageSelect">System Language</label>
                                    <select id="systemLanguageSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="en">English</option>
                                        <option value="es">Spanish</option>
                                        <option value="fr">French</option>
                                        <option value="de">German</option>
                                        <option value="zh">Chinese (Simplified)</option>
                                        <option value="af">Afrikaans</option>
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- My Courses Content (Training Manager) -->
                <div id="my-coursesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Courses</h2>
                        <p class="text-gray-600">Create new courses and manage your assigned course materials.</p>
                    </div>

                    <!-- Create New Course Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Course</h3>
                        <form id="createCourseForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseNameInput">Course Name</label>
                                <input id="courseNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Advanced Algebra">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseDescriptionInput">Course Description</label>
                                <textarea id="courseDescriptionInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Brief description of the course content."></textarea>
                            </div>
                            <div class="mb-4 text-center">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Course Picture (Optional)</label>
                                <img id="coursePicturePreview" class="inline-block h-32 w-32 rounded-lg mb-3 object-cover border border-gray-300" src="https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image" alt="Course Image">
                                <input type="file" id="coursePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseVideoInput">Upload Course Video (Optional)</label>
                                <input type="file" id="courseVideoInput" accept="video/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p id="courseVideoFileName" class="text-xs text-gray-500 mt-1 hidden"></p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="coursePdfInput">Upload Course Document (PDF, PPT, Optional)</label>
                                <input type="file" id="coursePdfInput" accept=".pdf,.ppt,.pptx" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p id="coursePdfFileName" class="text-xs text-gray-500 mt-1 hidden"></p>
                            </div>

                            <hr class="my-6 border-gray-200">

                            <h4 class="text-md font-semibold text-gray-800 mb-3">Add Questions to Course</h4>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="questionTypeSelect">Question Type</label>
                                <select id="questionTypeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select a question type</option>
                                    <option value="multiple-choice">Multiple Choice</option>
                                    <option value="true-false">True/False</option>
                                    <option value="matching">Matching</option>
                                    <option value="long-answer">Long Answer</option>
                                </select>
                            </div>

                            <!-- Question Input Area (Dynamic) -->
                            <div id="questionInputArea" class="space-y-4 mb-4">
                                <!-- Content will be dynamically loaded here based on question type -->
                            </div>

                            <button type="button" id="addQuestionBtn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150" disabled>
                                <i class="fas fa-plus mr-1"></i> Add Question
                            </button>

                            <div class="mt-6">
                                <h4 class="text-md font-semibold text-gray-800 mb-3">Questions for this Course:</h4>
                                <ul id="courseQuestionsList" class="border border-gray-200 rounded-md p-4 bg-gray-50 max-h-48 overflow-y-auto">
                                    <li class="text-gray-500 text-sm italic">No questions added yet.</li>
                                </ul>
                            </div>

                            <div class="flex justify-end mt-6 space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150" onclick="resetCourseForm()">
                                    Reset Form
                                </button>
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    Create Course
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Available Course Materials (Training Manager's Courses) -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Your Created Courses</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Video</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Questions</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="trainingManagerCoursesTableBody">
                                    <tr>
                                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses created by you. Create a new course above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="myCoursesShowingCount">0</span> to <span class="font-medium" id="myCoursesTotalCountDisplay">0</span> of <span class="font-medium" id="myCoursesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Student Enrolled Courses Content -->
                <div id="enrolled-coursesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Courses</h2>
                        <p class="text-gray-600">Courses you are currently enrolled in</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="studentCoursesList">
                        <div class="course-card bg-white rounded-lg shadow overflow-hidden transition duration-300">
                            <div class="h-40 bg-indigo-500 flex items-center justify-center">
                                <i class="fas fa-plus text-white text-5xl"></i>
                            </div>
                            <div class="p-6 flex flex-col items-center justify-center">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">Enroll in a Course</h3>
                                <button class="mt-2 bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                    <i class="fas fa-search mr-1"></i> Browse Courses
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm col-span-full text-center">No courses enrolled yet.</p>
                    </div>
                </div>
                
                <!-- Assignments Content -->
                <div id="assignmentsContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800" id="assignmentsPageTitle">Assignments</h2>
                        <p class="text-gray-600" id="assignmentsPageSubtitle">View and manage your assignments</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 bg-indigo-600 text-white rounded-md text-sm font-medium">All</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Pending</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Submitted</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Graded</button>
                            </div>
                            <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none" id="createAssignmentBtn">
                                <i class="fas fa-plus mr-1"></i> Create Assignment
                            </button>
                        </div>
                        <div class="divide-y divide-gray-200" id="assignmentsTableBody">
                            <div class="p-6 text-gray-500 text-sm text-center">No assignments to display.</div>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium">0</span> to <span class="font-medium">0</span> of <span class="font-medium">0</span> assignments</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Grades Content (Training Manager) -->
                <div id="gradesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800" id="gradesPageTitle">Gradebook</h2>
                        <p class="text-gray-600" id="gradesPageSubtitle">View and manage grades</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold text-gray-800">Course Grades</h3>
                                <div class="flex space-x-2">
                                    <select class="mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                        <option>All Courses</option>
                                        <option>Mathematics 101</option>
                                        <option>Introduction to Biology</option>
                                        <option>History of Art</option>
                                    </select>
                                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                        <i class="fas fa-download mr-1"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment 1</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment 2</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Midterm</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Final Exam</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="trainingManagerGradesTableBody">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades to display.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium">0</span> to <span class="font-medium">0</span> of <span class="font-medium">0</span> students</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>2</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Student Assignments Content (Placeholder) -->
                <div id="student-assignmentsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">My Assignments</h2>
                    <p class="text-gray-600 mb-6">View your assignments and submission status.</p>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-gray-700">Students can submit assignments and check their status here.</p>
                        <div class="divide-y divide-gray-200" id="studentAssignmentsList">
                            <div class="p-4 text-gray-500 text-sm text-center">No assignments for you to display.</div>
                        </div>
                    </div>
                </div>

                <!-- My Grades Content (Student) -->
                <div id="my-gradesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Grades</h2>
                        <p class="text-gray-600">View your grades for all courses</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Course Grades</h3>
                        </div>
                        <div class="p-6">
                            <div class="mb-8">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Mathematics 101</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feedback</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="studentGradesMath101">
                                            <tr>
                                                <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades for this course yet.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-4 p-4 bg-gray-50 rounded-md">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="text-sm font-medium text-gray-700">Current Grade:</span>
                                            <span class="ml-1 text-lg font-semibold text-gray-900">N/A</span>
                                        </div>
                                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                            View Full Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-8">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Introduction to Biology</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feedback</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="studentGradesBiology">
                                            <tr>
                                                <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades for this course yet.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-4 p-4 bg-gray-50 rounded-md">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="text-sm font-medium text-gray-700">Current Grade:</span>
                                            <span class="ml-1 text-lg font-semibold text-gray-900">N/A</span>
                                        </div>
                                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                            View Full Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Content (Placeholder) -->
                <div id="profileContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">User Profile</h2>
                    <p class="text-gray-600 mb-6">Manage your personal information.</p>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Personal Information</h3>
                        </div>
                        <div class="p-6">
                            <form id="profileSettingsForm">
                                <div class="mb-4 text-center">
                                    <label class="block text-gray-700 text-sm font-medium mb-2">Profile Picture</label>
                                    <img id="profilePicturePreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover border border-gray-300" src="https://placehold.co/96x96/ADD8E6/00008B?text=P" alt="Profile Picture">
                                    <input type="file" id="profilePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-md file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-blue-50 file:text-blue-700
                                        hover:file:bg-blue-100"/>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileFullNameInput">Full Name</label>
                                        <input type="text" id="profileFullNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Your Full Name">
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileEmailInput">Email Address</label>
                                        <input type="email" id="profileEmailInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your.email@example.com">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileContactInput">Contact Number</label>
                                        <input type="text" id="profileContactInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="+27 12 345 6789">
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileAddressInput">Address</label>
                                        <input type="text" id="profileAddressInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="123 Main St, City, Country">
                                    </div>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="profilePasswordInput">New Password (leave blank to keep current)</label>
                                    <input type="password" id="profilePasswordInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter new password">
                                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Messages Content (Placeholder) -->
                <div id="messagesContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Messages</h2>
                    <p class="text-gray-600 mb-6">Compose and view your messages.</p>
                    
                    <!-- Compose New Email Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Compose New Email to Student</h3>
                        <form id="composeEmailForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailRecipientSelect">To (Student)</label>
                                <select id="emailRecipientSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select a student</option>
                                    <!-- Student options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailSubjectInput">Subject</label>
                                <input type="text" id="emailSubjectInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter email subject">
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailBodyTextarea">Message</label>
                                <textarea id="emailBodyTextarea" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="6" placeholder="Write your message here..."></textarea>
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    <i class="fas fa-paper-plane mr-2"></i> Send Email
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Messages/Inbox (Placeholder) -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Your Inbox</h3>
                        <div class="divide-y divide-gray-200" id="inboxMessagesList">
                            <div class="p-4 text-gray-500 text-sm text-center">No messages in your inbox.</div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Content (Placeholder) -->
                <div id="notificationsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notifications</h2>
                    <p class="text-gray-600 mb-6">View all your system notifications.</p>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-gray-700">All system notifications will be listed here.</p>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        // Global variables for message modal
        const messageModal = document.getElementById('messageModal');
        const messageModalTitle = document.getElementById('messageModalTitle');
        const messageModalContent = document.getElementById('messageModalContent');

        function showMessageModal(title, content) {
            messageModalTitle.textContent = title;
            messageModalContent.textContent = content;
            messageModal.classList.remove('hidden');
            messageModal.classList.add('show');
        }

        function hideMessageModal() {
            messageModal.classList.remove('show');
            messageModal.classList.add('hidden');
        }

        // Global variables for Add User Modal
        const addUserModal = document.getElementById('addUserModal');
        const userPicturePreview = document.getElementById('userPicturePreview');
        const userPictureInput = document.getElementById('userPictureInput');

        userPictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userPicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP"; // Reset to placeholder
            }
        });

        function showAddUserModal() {
            addUserModal.classList.remove('hidden');
            addUserModal.classList.add('show');
            userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP"; // Reset preview on open
        }

        function hideAddUserModal() {
            addUserModal.classList.remove('show');
            addUserModal.classList.add('hidden');
            // Clear the form fields and reset image preview when closing
            document.getElementById('addUserForm').reset();
            userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP";
        }

        // Dropdown toggle function
        function toggleDropdown(button) {
            const menu = button.nextElementSibling;
            if (menu && menu.classList.contains('dropdown-menu')) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const dropdowns = document.querySelectorAll('.dropdown-menu:not(.hidden)');
            dropdowns.forEach(dropdown => {
                const parentDropdown = dropdown.closest('.dropdown');
                if (parentDropdown && !parentDropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        });

        // Function to show specific content section
        function showSection(sectionId) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            // Show the requested section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                // Update page title
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    // Extract title from section ID, e.g., "user-managementContent" -> "User Management"
                    let titleText = sectionId.replace('Content', '').replace(/-/g, ' ');
                    titleText = titleText.charAt(0).toUpperCase() + titleText.slice(1); // Capitalize first letter
                    // Special handling for the renamed sections
                    if (sectionId === 'course-contentContent') {
                        pageTitle.textContent = 'Course Content Overview';
                    } else if (sectionId === 'programme-managementContent') {
                        pageTitle.textContent = 'Programme Management';
                    } else if (sectionId === 'user-programme-assignmentContent') {
                        pageTitle.textContent = 'Assign Students to Programmes';
                    } else if (sectionId === 'profileContent') {
                        pageTitle.textContent = 'User Profile';
                    } else if (sectionId === 'reportsContent') {
                        pageTitle.textContent = 'Reports';
                    } else if (sectionId === 'my-coursesContent') { // New for Training Manager
                         pageTitle.textContent = 'My Courses';
                    }
                    else {
                         pageTitle.textContent = titleText;
                    }
                }
            }

            // Update active state in sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`.sidebar-item[data-section="${sectionId.replace('Content', '')}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }

            // Logic for populating sections when they are shown
            if (sectionId === 'course-contentContent') { // Admin's view of all courses
                renderAllExistingCoursesTable();
            }
            if (sectionId === 'programme-managementContent') {
                populateLinkedCoursesSelection();
                renderExistingProgramsTable();
            }
            if (sectionId === 'user-programme-assignmentContent') {
                renderProgrammesForAssignmentTable();
            }
            if (sectionId === 'system-settingsContent') {
                loadSystemSettings();
            }
            if (sectionId === 'profileContent') {
                loadProfileSettings();
            }
            if (sectionId === 'dashboardContent') {
                updateDashboardStats();
            }
            if (sectionId === 'reportsContent') {
                populateReportCourseSelect();
            }
            if (sectionId === 'my-coursesContent') { // Training Manager's "My Courses"
                renderTrainingManagerCoursesTable();
            }
            if (sectionId === 'messagesContent') { // New: Populate student dropdown for emails
                populateStudentEmailDropdown();
            }

            // Close mobile sidebar if open
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth <= 1023 && sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsernameInput').value;
            const password = document.getElementById('loginPasswordInput').value;
            const role = document.getElementById('userRoleSelect').value;
            
            // In a real app, you'd validate credentials against a backend
            // For this demo, we just simulate login and set user details
            const userExists = allUsersData.some(u => u.name.toLowerCase() === username.toLowerCase() && u.role === role);

            if (!userExists) {
                showMessageModal('Login Error', 'Invalid username or role. Please try again.');
                return;
            }

            // Find the specific user object for more detailed info
            const userLoggedIn = allUsersData.find(u => u.name.toLowerCase() === username.toLowerCase() && u.role === role);


            if (username && password && userLoggedIn) {
                const loginModalElement = document.getElementById('loginModal');
                if (loginModalElement) {
                    loginModalElement.classList.add('hidden');
                } else {
                    console.error("Error: loginModal element not found.");
                    showMessageModal('Critical Error', 'The login dialog could not be hidden. Please refresh the page.');
                    return;
                }
                
                // Set the logged-in user data from the dummy data
                loggedInUser.id = userLoggedIn.id;
                loggedInUser.name = userLoggedIn.name;
                loggedInUser.role = userLoggedIn.role;
                loggedInUser.fullName = userLoggedIn.name + (userLoggedIn.surname ? ` ${userLoggedIn.surname}` : ''); // Only add surname if it exists
                loggedInUser.email = userLoggedIn.email;
                loggedInUser.picture = userLoggedIn.picture;

                // Update display usernames and role
                document.getElementById('sidebarUsername').textContent = loggedInUser.fullName;
                document.getElementById('sidebarUserrole').textContent = loggedInUser.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                document.getElementById('topNavUsername').textContent = loggedInUser.fullName;
                document.getElementById('greetingName').textContent = loggedInUser.name; // Only first name for greeting
                document.querySelector('#sidebar .user-info img').src = loggedInUser.picture;
                document.querySelector('header .dropdown img').src = loggedInUser.picture;


                // Show/hide navigation sections based on role
                document.querySelectorAll('.nav-section').forEach(section => {
                    section.classList.add('hidden');
                });

                let navSectionToShowId;
                if (role === 'administrator') {
                    navSectionToShowId = 'adminNav';
                } else if (role === 'training_manager') {
                    navSectionToShowId = 'trainingManagerNav';
                }
                else { // student
                    navSectionToShowId = `studentNav`;
                }
                const navSectionElement = document.getElementById(navSectionToShowId);
                if (navSectionElement) {
                    navSectionElement.classList.remove('hidden');
                } else {
                    console.error(`Navigation section with ID '${navSectionToShowId}' not found.`);
                    showMessageModal('Configuration Error', 'Could not find the navigation section for your role. Please contact support.');
                }

                // Show appropriate default section based on role
                let defaultSectionId = 'dashboardContent';
                if (role === 'training_manager') {
                    defaultSectionId = 'my-coursesContent';
                } else if (role === 'student') {
                    defaultSectionId = 'enrolled-coursesContent';
                }
                showSection(defaultSectionId);
                updateDashboardStats(); // Update dashboard stats after login

            } else {
                showMessageModal('Login Error', 'Please enter both username and password, and select a role.');
            }
        });

        // Event listeners for sidebar navigation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default link behavior
                const sectionId = this.getAttribute('data-section') + 'Content';
                showSection(sectionId);
            });
        });

        // Logout functionality
        function handleLogout() {
            localStorage.removeItem('loggedInUser');
            showMessageModal('Logged Out', 'You have been successfully logged out.');
            document.getElementById('loginModal').classList.remove('hidden');
            
            // Reset UI
            document.getElementById('sidebarUsername').textContent = '';
            document.getElementById('sidebarUserrole').textContent = '';
            document.getElementById('topNavUsername').textContent = '';
            document.getElementById('greetingName').textContent = '';
            document.querySelector('#sidebar .user-info img').src = 'https://placehold.co/40x40/FF5733/FFFFFF?text=U';
            document.querySelector('header .dropdown img').src = 'https://placehold.co/32x32/FF5733/FFFFFF?text=U';
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-section').forEach(section => section.classList.add('hidden'));
            document.getElementById('pageTitle').textContent = 'SKILLSCONNECT LMS';
            
            // Reset loggedInUser state
            loggedInUser = {
                id: null,
                name: '',
                role: '',
                fullName: '',
                email: '',
                contact: '',
                address: '',
                picture: 'https://placehold.co/96x96/ADD8E6/00008B?text=P'
            };
            updateDashboardStats(); // Reset dashboard stats on logout
        }
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        document.getElementById('topLogoutBtn').addEventListener('click', handleLogout);

        // Dummy logged in user data (will be populated on successful login)
        let loggedInUser = {
            id: null, // Will be set on login
            name: '',
            role: '',
            fullName: '',
            email: '',
            contact: '',
            address: '',
            picture: 'https://placehold.co/96x96/ADD8E6/00008B?text=P'
        };

        // Global array to store user data
        let allUsersData = [
            // Dummy Administrator
            {
                id: 1,
                name: 'Admin',
                surname: 'User',
                email: 'admin@skillsconnect.com',
                idNumber: 'ADM001',
                company: 'SkillsConnect',
                role: 'administrator',
                picture: 'https://placehold.co/40x40/FF5733/FFFFFF?text=AD',
                status: 'active',
                enrollmentDate: '2023-01-01',
                endDate: null,
                coursesEnrolled: [],
                totalHoursSpent: 0
            },
            // Dummy Training Manager (formerly Teacher)
            {
                id: 2,
                name: 'Jane',
                surname: 'Trainer',
                email: 'jane.trainer@skillsconnect.com',
                idNumber: 'TRM001',
                company: 'SkillsConnect',
                role: 'training_manager',
                picture: 'https://placehold.co/40x40/5DADE2/FFFFFF?text=JT',
                status: 'active',
                enrollmentDate: '2023-02-15',
                endDate: null,
                coursesEnrolled: [],
                totalHoursSpent: 0
            },
            // Dummy Students
            {
                id: 3,
                name: 'Alice',
                surname: '', // Changed to empty string
                email: 'alice@skillsconnect.com',
                idNumber: 'STD001',
                company: 'Global Corp',
                role: 'student',
                picture: 'https://placehold.co/40x40/F1C40F/FFFFFF?text=A',
                status: 'active',
                enrollmentDate: '2023-03-01',
                endDate: null,
                coursesEnrolled: [
                    { courseId: 101, enrollmentDate: '2023-03-01', completionDate: null, hoursSpent: 25 },
                    { courseId: 102, enrollmentDate: '2023-04-10', completionDate: '2023-06-20', hoursSpent: 40 }
                ],
                totalHoursSpent: 65
            },
            {
                id: 4,
                name: 'Bob',
                surname: '', // Changed to empty string
                email: 'bob@skillsconnect.com',
                idNumber: 'STD002',
                company: 'Local Business',
                role: 'student',
                picture: 'https://placehold.co/40x40/FF6347/FFFFFF?text=B',
                status: 'active',
                enrollmentDate: '2023-03-05',
                endDate: null,
                coursesEnrolled: [
                    { courseId: 101, enrollmentDate: '2023-03-05', completionDate: '2023-05-15', hoursSpent: 30 }
                ],
                totalHoursSpent: 30
            },
            {
                id: 5,
                name: 'Charlie',
                surname: '', // Changed to empty string
                email: 'charlie@skillsconnect.com',
                idNumber: 'STD003',
                company: 'Tech Solutions',
                role: 'student',
                picture: 'https://placehold.co/40x40/A9A9A9/FFFFFF?text=C',
                status: 'deactivated', // Inactive user
                enrollmentDate: '2023-01-10',
                endDate: '2023-02-01',
                coursesEnrolled: [
                    { courseId: 103, enrollmentDate: '2023-01-10', completionDate: null, hoursSpent: 5 }
                ],
                totalHoursSpent: 5
            }
        ];

        // Add User Button Listener
        document.getElementById('addUserBtn').addEventListener('click', showAddUserModal);

        // Add User Form Submission
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('userNameInput').value.trim();
            const surname = document.getElementById('userSurnameInput').value.trim();
            const email = document.getElementById('userEmailInput').value.trim();
            const idNumber = document.getElementById('userIDNumberInput').value.trim();
            const companyName = document.getElementById('companyNameInput').value.trim();
            const password = document.getElementById('userPasswordInput').value.trim();
            const role = document.getElementById('newUserRoleSelect').value;
            const userPictureFile = userPictureInput.files[0];
            let userPictureSrc = '';

            if (!name || !surname || !email || !idNumber || !password || !companyName) {
                showMessageModal('Input Error', 'Please fill in all fields.');
                return;
            }

            // Basic email validation
            if (!email.includes('@') || !email.includes('.')) {
                showMessageModal('Input Error', 'Please enter a valid email address.');
                return;
            }

            // Generate a simple unique ID for the user
            const userId = Date.now();

            // Handle user picture
            if (userPictureFile) {
                userPictureSrc = URL.createObjectURL(userPictureFile);
            } else {
                // Generate initials for placeholder if no image is uploaded
                const initials = `${name.charAt(0)}${surname.charAt(0)}`.toUpperCase();
                const randomColor = Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                userPictureSrc = `https://placehold.co/40x40/${randomColor}/FFFFFF?text=${initials}`;
            }

            const newUser = {
                id: userId,
                name: name,
                surname: surname,
                email: email,
                idNumber: idNumber,
                company: companyName,
                role: role,
                picture: userPictureSrc,
                status: 'active', // Default status
                enrollmentDate: new Date().toISOString().slice(0, 10), // Current date as start date
                endDate: null, // No end date initially
                coursesEnrolled: [],
                totalHoursSpent: 0
            };
            allUsersData.push(newUser); // Add new user to the global array

            renderUserTable(); // Re-render the user table to include the new user
            updateDashboardStats(); // Update dashboard stats after adding user

            showMessageModal('Success', `${name} ${surname} has been added as a ${role.replace('_', ' ')}.`);
            hideAddUserModal();
        });

        function renderUserTable() {
            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = ''; // Clear existing rows

            if (allUsersData.length === 0) {
                userTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No users to display. Click "Add User" to add new entries.</td>
                    </tr>
                `;
                document.getElementById('usersTotalCount').textContent = 0;
                document.getElementById('usersShowingCount').textContent = 0;
                document.getElementById('usersTotalCountDisplay').textContent = 0;
                return;
            }

            allUsersData.forEach(user => {
                const newRow = userTableBody.insertRow();
                newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');
                newRow.dataset.userId = user.id;

                const nameCell = newRow.insertCell();
                nameCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                nameCell.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <img class="h-10 w-10 rounded-full object-cover" src="${user.picture}" alt="${user.name} ${user.surname}">
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${user.name} ${user.surname}</div>
                            <div class="text-sm text-gray-500">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</div>
                        </div>
                    </div>
                `;

                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.email}</td>`;
                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.idNumber}</td>`;
                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.company}</td>`;
                
                const roleCell = newRow.insertCell();
                roleCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                let roleColorClass;
                switch (user.role) {
                    case 'administrator':
                        roleColorClass = 'bg-indigo-100 text-indigo-800';
                        break;
                    case 'training_manager':
                        roleColorClass = 'bg-yellow-100 text-yellow-800';
                        break;
                    case 'student':
                        roleColorClass = 'bg-blue-100 text-blue-800';
                        break;
                    default:
                        roleColorClass = 'bg-gray-100 text-gray-800';
                }
                roleCell.innerHTML = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleColorClass}">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>`;

                const statusCell = newRow.insertCell();
                statusCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                let statusClass = user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                statusCell.innerHTML = `
                    <button class="status-toggle-btn px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}" data-status="${user.status}">
                        ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                    </button>
                `;
                statusCell.querySelector('.status-toggle-btn').addEventListener('click', function() {
                    const button = this;
                    const rowUserId = parseInt(button.closest('tr').dataset.userId);
                    let userToUpdate = allUsersData.find(u => u.id === rowUserId);

                    if (userToUpdate) {
                        if (userToUpdate.status === 'active') {
                            userToUpdate.status = 'deactivated';
                            userToUpdate.endDate = new Date().toISOString().slice(0, 10); // Set end date on deactivation
                            button.textContent = 'Deactivated';
                            button.classList.remove('bg-green-100', 'text-green-800');
                            button.classList.add('bg-red-100', 'text-red-800');
                            showMessageModal('User Status', `User ${userToUpdate.name} status changed to Deactivated.`);
                        } else {
                            userToUpdate.status = 'active';
                            userToUpdate.endDate = null; // Clear end date on reactivation
                            button.textContent = 'Active';
                            button.classList.remove('bg-red-100', 'text-red-800');
                            button.classList.add('bg-green-100', 'text-green-800');
                            showMessageModal('User Status', `User ${userToUpdate.name} status changed to Active.`);
                        }
                        updateDashboardStats(); // Update dashboard stats after status change
                    }
                });

                newRow.insertCell().outerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                        <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                    </td>
                `;
            });

            document.getElementById('usersTotalCount').textContent = allUsersData.length;
            document.getElementById('usersShowingCount').textContent = allUsersData.length > 0 ? 1 : 0;
            document.getElementById('usersTotalCountDisplay').textContent = allUsersData.length;
        }


        // Sidebar toggle for mobile and hover for desktop
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileCloseSidebarBtn = document.getElementById('mobileCloseSidebarBtn'); // New button for closing mobile sidebar
        const toggleSidebarBtn = document.getElementById('toggleSidebar'); // Desktop toggle button
        const contentArea = document.getElementById('contentArea');

        // Mobile sidebar toggle (drawer functionality)
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.add('active'); // Show mobile sidebar
        });
        mobileCloseSidebarBtn.addEventListener('click', () => {
            sidebar.classList.remove('active'); // Hide mobile sidebar
        });

        // Desktop sidebar functionality (hover to expand, button for manual toggle)
        let isManuallyCollapsed = false;

        // Initial state: collapse on desktop if window width is large enough
        window.addEventListener('load', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.add('collapsed');
            }
        });
        window.addEventListener('resize', () => {
            if (window.innerWidth < 1024) {
                sidebar.classList.remove('collapsed'); // Ensure it's not collapsed on mobile
                isManuallyCollapsed = false; // Reset manual state for mobile
            } else {
                // If returning to desktop from mobile, collapse it by default unless manually expanded before
                if (!isManuallyCollapsed) { // If it wasn't manually expanded before going to mobile
                    sidebar.classList.add('collapsed');
                }
            }
        });

        sidebar.addEventListener('mouseenter', () => {
            if (window.innerWidth >= 1024) { // Only on desktop
                sidebar.classList.remove('collapsed');
            }
        });

        sidebar.addEventListener('mouseleave', () => {
            if (window.innerWidth >= 1024) { // Only on desktop
                sidebar.classList.add('collapsed');
            }
        });
        
        // Manual toggle button for desktop
        toggleSidebarBtn.addEventListener('click', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.toggle('collapsed');
                isManuallyCollapsed = sidebar.classList.contains('collapsed'); // Update manual state
            }
        });


        // Make entire table rows clickable (if they have data-link attribute) - Adjusted to avoid status button
        document.addEventListener('click', function(e) {
            // Ensure the clicked element or its parent is not an action button or the status toggle button
            if (e.target.closest('a') || e.target.closest('button') || e.target.classList.contains('status-toggle-btn')) {
                return;
            }

            let targetRow = e.target.closest('tr[data-link]');
            if (targetRow) {
                const link = targetRow.getAttribute('data-link');
                const sectionMatch = link.match(/^([a-zA-Z-]+)\.html/);
                if (sectionMatch) {
                    const sectionId = sectionMatch[1] + 'Content';
                    showMessageModal('Row Clicked', `You clicked on a row linked to: ${link}. In a real application, this would show user details or navigate to a specific page.`);
                } else {
                    showMessageModal('Row Clicked', `You clicked on a row linked to: ${link}. This action is currently simulated.`);
                }
            }
        });


        // Show login modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginModal').classList.remove('hidden');
            renderUserTable(); // Initial render of the user table with dummy data
            renderAllExistingCoursesTable(); // Initial render of the admin courses table
        });


        // Course Management Specific Logic
        let allCoursesData = [
            {
                id: 101,
                name: 'Introduction to Web Development',
                description: 'Learn the basics of HTML, CSS, and JavaScript.',
                videoFileName: 'intro_web_dev.mp4',
                pdfFileName: 'web_dev_notes.pdf',
                picture: 'https://placehold.co/128x128/E0E7FF/4F46E5?text=Web+Dev',
                questions: [
                    { type: 'multiple-choice', text: 'What does HTML stand for?', options: ['Hyper Text Markup Language', 'Hyperlink and Text Markup Language', 'High Tech Modern Language'], correctAnswer: 0 },
                    { type: 'true-false', text: 'CSS is used for styling web pages.', correctAnswer: true }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            },
            {
                id: 102,
                name: 'Data Science Fundamentals',
                description: 'Explore data analysis, machine learning, and statistical modeling.',
                videoFileName: 'data_science_intro.mp4',
                pdfFileName: 'data_science_guide.pdf',
                picture: 'https://placehold.co/128x128/D1FAE5/065F46?text=Data+Science',
                questions: [
                    { type: 'multiple-choice', text: 'Which language is commonly used in data science?', options: ['Java', 'Python', 'C++'], correctAnswer: 1 },
                    { type: 'matching', pairs: [{term: 'Regression', definition: 'Predicting continuous values'}, {term: 'Classification', definition: 'Categorizing data'}] }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            },
            {
                id: 103,
                name: 'Advanced Algorithms',
                description: 'Deep dive into complex algorithms and data structures.',
                videoFileName: 'advanced_algo.mp4',
                pdfFileName: 'algo_handbook.pdf',
                picture: 'https://placehold.co/128x128/FFE4E6/E04C6C?text=Algorithms',
                questions: [
                    { type: 'true-false', text: 'Big O notation describes the efficiency of an algorithm.', correctAnswer: true }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            }
        ];
        let currentCourseQuestions = [];
        let currentVideoFileName = '';
        let currentCoursePdfFileName = '';
        const coursePicturePreview = document.getElementById('coursePicturePreview');
        const coursePictureInput = document.getElementById('coursePictureInput');
        const coursePdfInput = document.getElementById('coursePdfInput');
        const coursePdfFileNameDisplay = document.getElementById('coursePdfFileName');

        // Function to render question input fields based on type
        function renderQuestionInputArea(type) {
            const questionInputArea = document.getElementById('questionInputArea');
            questionInputArea.innerHTML = ''; // Clear previous inputs
            document.getElementById('addQuestionBtn').disabled = true; // Disable until valid input

            if (type === 'multiple-choice') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="mcQuestionText">Question Text</label>
                        <textarea id="mcQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2" placeholder="Enter multiple-choice question"></textarea>
                    </div>
                    <div id="mcOptionsContainer" class="space-y-2 mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Options (Check correct answer)</label>
                        <div class="flex items-center">
                            <input type="radio" name="mcAnswer" value="0" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option A">
                            <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="mcAnswer" value="1" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option B">
                            <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <button type="button" id="addMcOptionBtn" class="text-indigo-600 text-sm hover:text-indigo-800 focus:outline-none">
                        <i class="fas fa-plus mr-1"></i> Add Option
                    </button>
                `;
                document.getElementById('addMcOptionBtn').addEventListener('click', addMultipleChoiceOption);
                document.querySelectorAll('.remove-option-btn').forEach(button => {
                    button.addEventListener('click', removeMultipleChoiceOption);
                });
                document.getElementById('mcQuestionText').addEventListener('input', checkQuestionReadiness);
                document.querySelectorAll('.mc-option').forEach(input => {
                    input.addEventListener('input', checkQuestionReadiness);
                });
                document.querySelectorAll('input[name="mcAnswer"]').forEach(radio => {
                    radio.addEventListener('change', checkQuestionReadiness);
                });

            } else if (type === 'true-false') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="tfQuestionText">Question Text</label>
                        <textarea id="tfQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2" placeholder="Enter true/false statement"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Correct Answer</label>
                        <div class="flex items-center space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="tfAnswer" value="true" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <span class="ml-2 text-gray-700">True</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="tfAnswer" value="false" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <span class="ml-2 text-gray-700">False</span>
                            </label>
                        </div>
                    </div>
                `;
                document.getElementById('tfQuestionText').addEventListener('input', checkQuestionReadiness);
                document.querySelectorAll('input[name="tfAnswer"]').forEach(radio => {
                    radio.addEventListener('change', checkQuestionReadiness);
                });
            } else if (type === 'matching') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Matching Pairs (Term : Definition)</label>
                        <div id="matchingPairsContainer" class="space-y-2 mb-4">
                            <div class="flex items-center space-x-2">
                                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                                <span class="text-gray-500">:</span>
                                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                                <button type="button" class="remove-pair-btn text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                                <span class="text-gray-500">:</span>
                                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                                <button type="button" class="remove-pair-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" id="addMatchingPairBtn" class="text-indigo-600 text-sm hover:text-indigo-800 focus:outline-none">
                            <i class="fas fa-plus mr-1"></i> Add Pair
                        </button>
                    </div>
                `;
                document.getElementById('addMatchingPairBtn').addEventListener('click', addMatchingPair);
                document.querySelectorAll('.remove-pair-btn').forEach(button => {
                    button.addEventListener('click', removeMatchingPair);
                });
                document.querySelectorAll('.matching-term, .matching-definition').forEach(input => {
                    input.addEventListener('input', checkQuestionReadiness);
                });
            } else if (type === 'long-answer') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="longAnswerQuestionText">Question Text</label>
                        <textarea id="longAnswerQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Enter long answer question"></textarea>
                    </div>
                `;
                document.getElementById('longAnswerQuestionText').addEventListener('input', checkQuestionReadiness);
            }
            checkQuestionReadiness();
        }

        // Validate if question input fields are filled to enable "Add Question" button
        function checkQuestionReadiness() {
            const type = document.getElementById('questionTypeSelect').value;
            const addQuestionBtn = document.getElementById('addQuestionBtn');
            let isValid = false;

            if (type === 'multiple-choice') {
                const questionText = document.getElementById('mcQuestionText').value.trim();
                const options = Array.from(document.querySelectorAll('.mc-option')).map(input => input.value.trim());
                const anyOptionFilled = options.some(option => option !== '');
                const anyRadioSelected = Array.from(document.querySelectorAll('input[name="mcAnswer"]')).some(radio => radio.checked);
                isValid = questionText !== '' && options.length >= 2 && anyOptionFilled && anyRadioSelected;
            } else if (type === 'true-false') {
                const questionText = document.getElementById('tfQuestionText').value.trim();
                const anyRadioSelected = Array.from(document.querySelectorAll('input[name="tfAnswer"]')).some(radio => radio.checked);
                isValid = questionText !== '' && anyRadioSelected;
            } else if (type === 'matching') {
                const pairs = [];
                document.querySelectorAll('#matchingPairsContainer > div').forEach(pairDiv => {
                    const term = pairDiv.querySelector('.matching-term').value.trim();
                    const definition = pairDiv.querySelector('.matching-definition').value.trim();
                    if (term && definition) {
                        pairs.push({ term, definition });
                    }
                });
                const allPairsValid = pairs.every(pair => pair.term !== '' && pair.definition !== '');
                isValid = pairs.length >= 2 && allPairsValid;
            } else if (type === 'long-answer') {
                const questionText = document.getElementById('longAnswerQuestionText').value.trim();
                isValid = questionText !== '';
            }
            addQuestionBtn.disabled = !isValid;
        }

        // Multiple Choice: Add new option field
        function addMultipleChoiceOption() {
            const container = document.getElementById('mcOptionsContainer');
            const optionCount = container.children.length;
            const newOptionDiv = document.createElement('div');
            newOptionDiv.classList.add('flex', 'items-center');
            newOptionDiv.innerHTML = `
                <input type="radio" name="mcAnswer" value="${optionCount}" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option ${String.fromCharCode(65 + optionCount)}">
                <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(newOptionDiv);
            newOptionDiv.querySelector('.remove-option-btn').addEventListener('click', removeMultipleChoiceOption);
            newOptionDiv.querySelector('.mc-option').addEventListener('input', checkQuestionReadiness);
            newOptionDiv.querySelector('input[name="mcAnswer"]').addEventListener('change', checkQuestionReadiness);
            checkQuestionReadiness();
        }

        // Multiple Choice: Remove option field
        function removeMultipleChoiceOption(event) {
            const optionDiv = event.target.closest('.flex.items-center');
            if (optionDiv) {
                optionDiv.remove();
                // Re-index radio button values
                document.querySelectorAll('#mcOptionsContainer .flex.items-center').forEach((div, index) => {
                    div.querySelector('input[type="radio"]').value = index;
                });
            }
            checkQuestionReadiness();
        }

        // Matching: Add new pair field
        function addMatchingPair() {
            const container = document.getElementById('matchingPairsContainer');
            const newPairDiv = document.createElement('div');
            newPairDiv.classList.add('flex', 'items-center', 'space-x-2');
            newPairDiv.innerHTML = `
                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                <span class="text-gray-500">:</span>
                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                <button type="button" class="remove-pair-btn text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(newPairDiv);
            newPairDiv.querySelector('.remove-pair-btn').addEventListener('click', removeMatchingPair);
            newPairDiv.querySelectorAll('.matching-term, .matching-definition').forEach(input => {
                input.addEventListener('input', checkQuestionReadiness);
            });
            checkQuestionReadiness();
        }

        // Matching: Remove pair field
        function removeMatchingPair(event) {
            const pairDiv = event.target.closest('.flex.items-center');
            if (pairDiv) {
                pairDiv.remove();
            }
            checkQuestionReadiness();
        }

        // Event listener for question type selection dropdown
        document.getElementById('questionTypeSelect').addEventListener('change', function() {
            renderQuestionInputArea(this.value);
        });

        // Event listener for adding a question to the current course's temporary list
        document.getElementById('addQuestionBtn').addEventListener('click', function() {
            const type = document.getElementById('questionTypeSelect').value;
            let question = { type: type };

            if (type === 'multiple-choice') {
                const questionText = document.getElementById('mcQuestionText').value.trim();
                const options = Array.from(document.querySelectorAll('.mc-option')).map(input => input.value.trim());
                const correctAnswerIndex = document.querySelector('input[name="mcAnswer"]:checked')?.value;

                if (!questionText || options.some(o => !o) || correctAnswerIndex === undefined) {
                    showMessageModal('Input Error', 'Please fill in all multiple-choice fields and select a correct answer.');
                    return;
                }

                question.text = questionText;
                question.options = options;
                question.correctAnswer = parseInt(correctAnswerIndex);

            } else if (type === 'true-false') {
                const questionText = document.getElementById('tfQuestionText').value.trim();
                const correctAnswer = document.querySelector('input[name="tfAnswer"]:checked')?.value;

                if (!questionText || !correctAnswer) {
                    showMessageModal('Input Error', 'Please fill in the true/false question and select a correct answer.');
                    return;
                }

                question.text = questionText;
                question.correctAnswer = correctAnswer === 'true';

            } else if (type === 'matching') {
                const pairs = [];
                document.querySelectorAll('#matchingPairsContainer > div').forEach(pairDiv => {
                    const term = pairDiv.querySelector('.matching-term').value.trim();
                    const definition = pairDiv.querySelector('.matching-definition').value.trim();
                    if (term && definition) {
                        pairs.push({ term, definition });
                    }
                });

                if (pairs.length < 2 || pairs.some(pair => !pair.term || !pair.definition)) { // Require at least 2 complete pairs
                    showMessageModal('Input Error', 'Please add at least two complete matching pairs (Term and Definition).');
                    return;
                }
                question.pairs = pairs;
            } else if (type === 'long-answer') {
                const questionText = document.getElementById('longAnswerQuestionText').value.trim();
                if (!questionText) {
                    showMessageModal('Input Error', 'Please enter the long answer question text.');
                    return;
                }
                question.text = questionText;
            }
            else {
                showMessageModal('Error', 'Please select a question type.');
                return;
            }

            currentCourseQuestions.push(question);
            updateCourseQuestionsList();
            showMessageModal('Question Added', `A ${type.replace('-', ' ')} question has been added.`);
            // Clear question form after adding
            document.getElementById('questionTypeSelect').value = '';
            renderQuestionInputArea(''); // Clear inputs
            document.getElementById('addQuestionBtn').disabled = true;
        });

        // Update the displayed list of questions for the current course
        function updateCourseQuestionsList() {
            const list = document.getElementById('courseQuestionsList');
            list.innerHTML = ''; // Clear existing list

            if (currentCourseQuestions.length === 0) {
                list.innerHTML = '<li class="text-gray-500 text-sm italic">No questions added yet.</li>';
                return;
            }

            currentCourseQuestions.forEach((q, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'px-3', 'border-b', 'border-gray-100');
                if (index === currentCourseQuestions.length - 1) {
                    listItem.classList.remove('border-b'); // Remove border for last item
                }
                let questionSummary = '';
                if (q.type === 'multiple-choice') {
                    questionSummary = `MC: ${q.text.substring(0, 50)}${q.text.length > 50 ? '...' : ''} (${q.options.length} options)`;
                } else if (q.type === 'true-false') {
                    questionSummary = `T/F: ${q.text.substring(0, 50)}${q.text.length > 50 ? '...' : ''}`;
                } else if (q.type === 'matching') {
                    questionSummary = `Matching: ${q.pairs.length} pairs`;
                } else if (q.type === 'long-answer') {
                    questionSummary = `Long Answer: ${q.text.substring(0, 50)}${q.text.length > 50 ? '...' : ''}`;
                }

                listItem.innerHTML = `
                    <span class="text-sm text-gray-700">${index + 1}. ${questionSummary}</span>
                    <button type="button" class="text-red-600 hover:text-red-900 text-sm delete-question-btn" data-index="${index}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                list.appendChild(listItem);
            });

            document.querySelectorAll('.delete-question-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const indexToDelete = parseInt(this.dataset.index);
                    currentCourseQuestions.splice(indexToDelete, 1);
                    updateCourseQuestionsList();
                    showMessageModal('Question Removed', 'Question has been removed from the course.');
                });
            });
        }

        // Handle video file name display
        document.getElementById('courseVideoInput').addEventListener('change', function() {
            const fileNameDisplay = document.getElementById('courseVideoFileName');
            if (this.files.length > 0) {
                fileNameDisplay.textContent = `Selected: ${this.files[0].name}`;
                fileNameDisplay.classList.remove('hidden');
                currentVideoFileName = this.files[0].name; // Store file name for display
            } else {
                fileNameDisplay.textContent = '';
                fileNameDisplay.classList.add('hidden');
                currentVideoFileName = '';
            }
        });

        // Handle PDF file name display
        coursePdfInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                coursePdfFileNameDisplay.textContent = `Selected: ${this.files[0].name}`;
                coursePdfFileNameDisplay.classList.remove('hidden');
                currentCoursePdfFileName = this.files[0].name;
            } else {
                coursePdfFileNameDisplay.textContent = '';
                coursePdfFileNameDisplay.classList.add('hidden');
                currentCoursePdfFileName = '';
            }
        });

        // Handle Course Picture preview
        coursePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    coursePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                coursePicturePreview.src = "https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image"; // Reset to placeholder
            }
        });


        // Reset Course Form
        function resetCourseForm() {
            document.getElementById('createCourseForm').reset();
            document.getElementById('questionTypeSelect').value = '';
            renderQuestionInputArea('');
            currentCourseQuestions = [];
            updateCourseQuestionsList();
            currentVideoFileName = '';
            currentCoursePdfFileName = '';
            document.getElementById('courseVideoFileName').classList.add('hidden');
            coursePdfFileNameDisplay.classList.add('hidden');
            coursePicturePreview.src = "https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image"; // Reset course picture preview
            document.getElementById('addQuestionBtn').disabled = true;
            showMessageModal('Form Reset', 'The course creation form has been cleared.');
        }

        // Handle Create Course Form Submission
        document.getElementById('createCourseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const courseName = document.getElementById('courseNameInput').value.trim();
            const courseDescription = document.getElementById('courseDescriptionInput').value.trim();

            if (!courseName || !courseDescription) {
                showMessageModal('Input Error', 'Please enter course name and description.');
                return;
            }

            if (currentCourseQuestions.length === 0) {
                showMessageModal('Input Error', 'Please add at least one question to the course.');
                return;
            }
            if (!loggedInUser.id) {
                showMessageModal('Authentication Error', 'Please log in as a Training Manager to create a course.');
                return;
            }

            const coursePicture = coursePicturePreview.src;

            const newCourse = {
                id: Date.now(),
                name: courseName,
                description: courseDescription,
                videoFileName: currentVideoFileName,
                pdfFileName: currentCoursePdfFileName,
                picture: coursePicture,
                questions: [...currentCourseQuestions],
                readStatus: false,
                creatorId: loggedInUser.id // Assign creator ID
            };
            allCoursesData.push(newCourse);

            renderTrainingManagerCoursesTable(); // Re-render the Training Manager's courses table
            renderAllExistingCoursesTable(); // Re-render the Admin's courses table
            populateLinkedCoursesSelection(); // Update courses available for programmes
            populateReportCourseSelect(); // Update courses available in reports dropdown

            updateDashboardStats(); // Update dashboard stats after adding course

            showMessageModal('Course Created', `Course "${courseName}" has been successfully created with ${currentCourseQuestions.length} questions.`);
            resetCourseForm();
        });

        // Render Training Manager's Courses Table
        function renderTrainingManagerCoursesTable() {
            const tableBody = document.getElementById('trainingManagerCoursesTableBody');
            tableBody.innerHTML = '';
            const myCourses = allCoursesData.filter(course => course.creatorId === loggedInUser.id);

            if (myCourses.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses created by you. Create a new course above.</td>
                    </tr>
                `;
            } else {
                myCourses.forEach(course => {
                    const newRow = tableBody.insertRow();
                    newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');

                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><img src="${course.picture}" alt="Course" class="h-10 w-10 rounded-md object-cover"></td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.name}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.description.substring(0, 50)}${course.description.length > 50 ? '...' : ''}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.videoFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.pdfFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.questions.length} questions</td>`;
                    newRow.insertCell().outerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            let currentCoursesCount = myCourses.length;
            document.getElementById('myCoursesTotalCount').textContent = currentCoursesCount;
            document.getElementById('myCoursesShowingCount').textContent = currentCoursesCount > 0 ? 1 : 0;
            document.getElementById('myCoursesTotalCountDisplay').textContent = currentCoursesCount;
        }

        // Render ALL Existing Courses Table (for Admin overview)
        function renderAllExistingCoursesTable() {
            const existingCoursesTableBody = document.getElementById('allExistingCoursesTableBody');
            existingCoursesTableBody.innerHTML = '';

            if (allCoursesData.length === 0) {
                existingCoursesTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses to display. Create a new course in "My Courses".</td>
                    </tr>
                `;
            } else {
                allCoursesData.forEach(course => {
                    const creator = allUsersData.find(user => user.id === course.creatorId);
                    const creatorName = creator ? `${creator.name} ${creator.surname}`.trim() + (creator.role ? ` (${creator.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')})` : '') : 'Unknown';

                    const newRow = existingCoursesTableBody.insertRow();
                    newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');

                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><img src="${course.picture}" alt="Course" class="h-10 w-10 rounded-md object-cover"></td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.name}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.description.substring(0, 50)}${course.description.length > 50 ? '...' : ''}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.videoFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.pdfFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.questions.length} questions</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${creatorName}</td>`;
                    newRow.insertCell().outerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            let currentCoursesCount = allCoursesData.length;
            document.getElementById('allCoursesTotalCount').textContent = currentCoursesCount;
            document.getElementById('allCoursesShowingCount').textContent = currentCoursesCount > 0 ? 1 : 0;
            document.getElementById('allCoursesTotalCountDisplay').textContent = currentCoursesCount;
        }


        // PDF Viewer Modal Logic
        const pdfViewerModal = document.getElementById('pdfViewerModal');
        const pdfModalTitle = document.getElementById('pdfModalTitle');
        const simulatedPdfContentFileName = document.getElementById('simulatedPdfContentFileName');
        let currentViewingDocumentId = null; // To keep track of which document is being viewed

        function showPdfViewerModal(documentName, documentId) {
            pdfModalTitle.textContent = `View Document: ${documentName}`;
            simulatedPdfContentFileName.textContent = documentName;
            currentViewingDocumentId = documentId; // Store the ID
            
            // Set initial state of Mark as Read button based on document status
            const markAsReadBtn = document.getElementById('markAsReadBtn');
            const course = allCoursesData.find(c => c.id === documentId);
            if (course && course.readStatus) {
                markAsReadBtn.textContent = 'Already Read';
                markAsReadBtn.disabled = true;
                markAsReadBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                markAsReadBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            } else {
                markAsReadBtn.textContent = 'Mark as Read';
                markAsReadBtn.disabled = false;
                markAsReadBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                markAsReadBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            }

            pdfViewerModal.classList.remove('hidden');
            pdfViewerModal.classList.add('show');
        }

        function hidePdfViewerModal() {
            pdfViewerModal.classList.remove('show');
            pdfViewerModal.classList.add('hidden');
            currentViewingDocumentId = null; // Clear the ID
        }

        // Mark as Read button listener inside PDF viewer modal
        document.getElementById('markAsReadBtn').addEventListener('click', function() {
            if (currentViewingDocumentId) {
                const courseIndex = allCoursesData.findIndex(c => c.id === currentViewingDocumentId);
                if (courseIndex !== -1) {
                    allCoursesData[courseIndex].readStatus = true;
                    showMessageModal('Completion Marked', `"${allCoursesData[courseIndex].pdfFileName}" marked as read.`);
                    // Update the UI in course content list as well
                    renderAllExistingCoursesTable(); // For admin view
                    renderTrainingManagerCoursesTable(); // For Training Manager view
                    // Disable the button in the modal
                    this.textContent = 'Already Read';
                    this.disabled = true;
                    this.classList.remove('bg-green-600', 'hover:bg-green-700');
                    this.classList.add('bg-gray-400', 'cursor-not-allowed');
                }
            }
        });


        // Programme Management Logic
        let allProgramsData = []; // Stores all created programme data
        const programmePicturePreview = document.getElementById('programmePicturePreview');
        const programmePictureInput = document.getElementById('programmePictureInput');
        const linkedCoursesSelection = document.getElementById('linkedCoursesSelection');

        // Handle Programme Picture preview
        programmePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    programmePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                programmePicturePreview.src = "https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image"; // Reset to placeholder
            }
        });

        // Populate courses for linking to a programme
        function populateLinkedCoursesSelection() {
            linkedCoursesSelection.innerHTML = '';
            if (allCoursesData.length === 0) {
                linkedCoursesSelection.innerHTML = '<p id="noCoursesAvailableForProgramme" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>';
            } else {
                allCoursesData.forEach(course => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('flex', 'items-center', 'py-1');
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="linkCourse_${course.id}" value="${course.id}" class="linked-course-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="linkCourse_${course.id}" class="ml-2 text-sm text-gray-700">${course.name}</label>
                    `;
                    linkedCoursesSelection.appendChild(checkboxDiv);
                });
            }
        }

        // Reset Programme Form
        function resetProgrammeForm() {
            document.getElementById('createProgrammeForm').reset();
            programmePicturePreview.src = "https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image";
            document.querySelectorAll('.linked-course-checkbox').forEach(checkbox => checkbox.checked = false);
            showMessageModal('Form Reset', 'The programme creation form has been cleared.');
        }

        // Handle Create Programme Form Submission
        document.getElementById('createProgrammeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const programmeName = document.getElementById('programmeNameInput').value.trim();
            const programmePicture = programmePicturePreview.src;
            const selectedCourseIds = Array.from(document.querySelectorAll('.linked-course-checkbox:checked'))
                                          .map(checkbox => parseInt(checkbox.value));

            if (!programmeName) {
                showMessageModal('Input Error', 'Please enter a programme name.');
                return;
            }

            const newProgramme = {
                id: Date.now(),
                name: programmeName,
                picture: programmePicture,
                linkedCourseIds: selectedCourseIds,
                assignedStudentIds: [] // Initially no students assigned
            };
            allProgramsData.push(newProgramme);
            
            renderExistingProgramsTable();
            renderProgrammesForAssignmentTable(); // Update the new assignment table
            updateDashboardStats(); // Update dashboard stats after adding programme

            showMessageModal('Programme Created', `Programme "${programmeName}" has been successfully created.`);
            resetProgrammeForm();
        });

        // Render Existing Programmes Table
        function renderExistingProgramsTable() {
            const tableBody = document.getElementById('existingProgrammesTableBody');
            tableBody.innerHTML = '';

            if (allProgramsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes to display. Create a new programme above.</td>
                    </tr>
                `;
            } else {
                allProgramsData.forEach(programme => {
                    const row = tableBody.insertRow();
                    row.classList.add('cursor-pointer', 'hover:bg-gray-50');
                    row.dataset.programmeId = programme.id; // Store programme ID on the row

                    const linkedCoursesCount = programme.linkedCourseIds.length;
                    const assignedStudentsCount = programme.assignedStudentIds.length;

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap"><img src="${programme.picture}" alt="Programme" class="h-10 w-10 rounded-md object-cover"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${programme.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${linkedCoursesCount} course(s)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${assignedStudentsCount} student(s)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-3 assign-students-btn" data-programme-id="${programme.id}">Assign Students</button>
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            // Update programme counts
            document.getElementById('programmesTotalCount').textContent = allProgramsData.length;
            document.getElementById('programmesShowingCount').textContent = allProgramsData.length > 0 ? 1 : 0;
            document.getElementById('programmesTotalCountDisplay').textContent = allProgramsData.length;
        }

        // Assign Students Modal Logic
        const assignStudentsModal = document.getElementById('assignStudentsModal');
        const assignStudentsModalTitle = document.getElementById('assignStudentsModalTitle');
        const assignStudentsList = document.getElementById('assignStudentsList');
        const noStudentsAvailableMsg = document.getElementById('noStudentsAvailable');
        let currentProgrammeIdToAssign = null;

        function showAssignStudentsModal(programmeId) {
            currentProgrammeIdToAssign = programmeId;
            const programme = allProgramsData.find(p => p.id === programmeId);
            if (!programme) {
                showMessageModal('Error', 'Programme not found.');
                return;
            }
            assignStudentsModalTitle.textContent = `Assign Students to: ${programme.name}`;
            assignStudentsList.innerHTML = ''; // Clear previous list

            const students = allUsersData.filter(user => user.role === 'student');

            if (students.length === 0) {
                noStudentsAvailableMsg.classList.remove('hidden');
            } else {
                noStudentsAvailableMsg.classList.add('hidden');
                students.forEach(student => {
                    // Check if student is already assigned to THIS programme
                    const isAssignedToThisProgramme = programme.assignedStudentIds.includes(student.id);
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('flex', 'items-center', 'py-1');
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="assignStudent_${student.id}" value="${student.id}" class="assign-student-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" ${isAssignedToThisProgramme ? 'checked' : ''}>
                        <label for="assignStudent_${student.id}" class="ml-2 text-sm text-gray-700">${student.name} ${student.surname} (${student.email})</label>
                    `;
                    assignStudentsList.appendChild(checkboxDiv);
                });
            }

            assignStudentsModal.classList.remove('hidden');
            assignStudentsModal.classList.add('show');
        }

        function hideAssignStudentsModal() {
            assignStudentsModal.classList.remove('show');
            assignStudentsModal.classList.add('hidden');
            currentProgrammeIdToAssign = null;
        }

        document.getElementById('saveAssignedStudentsBtn').addEventListener('click', function() {
            if (currentProgrammeIdToAssign) {
                const programme = allProgramsData.find(p => p.id === currentProgrammeIdToAssign);
                if (programme) {
                    const newlySelectedStudentIds = Array.from(document.querySelectorAll('.assign-student-checkbox:checked'))
                                                      .map(checkbox => parseInt(checkbox.value));
                    
                    // Students removed from this programme
                    const removedStudentIds = programme.assignedStudentIds.filter(id => !newlySelectedStudentIds.includes(id));
                    // Students newly added to this programme
                    const addedStudentIds = newlySelectedStudentIds.filter(id => !programme.assignedStudentIds.includes(id));

                    programme.assignedStudentIds = newlySelectedStudentIds; // Update the programme's assigned students

                    // Update each student's coursesEnrolled list based on programme's linked courses
                    const programmeLinkedCourses = programme.linkedCourseIds;

                    removedStudentIds.forEach(studentId => {
                        const student = allUsersData.find(u => u.id === studentId);
                        if (student) {
                            // Remove courses linked to this programme from student's enrolled list
                            student.coursesEnrolled = student.coursesEnrolled.filter(enr => 
                                !programmeLinkedCourses.includes(enr.courseId)
                            );
                            student.totalHoursSpent = student.coursesEnrolled.reduce((sum, c) => sum + (c.hoursSpent || 0), 0);
                        }
                    });

                    addedStudentIds.forEach(studentId => {
                        const student = allUsersData.find(u => u.id === studentId);
                        if (student) {
                            programmeLinkedCourses.forEach(courseId => {
                                // Add course to student's enrolled list if not already there
                                if (!student.coursesEnrolled.some(enr => enr.courseId === courseId)) {
                                    student.coursesEnrolled.push({
                                        courseId: courseId,
                                        enrollmentDate: new Date().toISOString().slice(0, 10),
                                        completionDate: null,
                                        hoursSpent: 0 // Initialize hours spent for this course
                                    });
                                }
                            });
                             student.totalHoursSpent = student.coursesEnrolled.reduce((sum, c) => sum + (c.hoursSpent || 0), 0);
                        }
                    });
                    
                    showMessageModal('Success', `Student assignments for "${programme.name}" updated.`);
                    renderExistingProgramsTable(); // Re-render programme table
                    renderProgrammesForAssignmentTable(); // Re-render assignment table
                    updateDashboardStats(); // Refresh dashboard counts
                }
            }
            hideAssignStudentsModal();
        });

        // New function to render the table in the "User Assignment to Programmes" section
        function renderProgrammesForAssignmentTable() {
            const tableBody = document.getElementById('programmesForAssignmentTableBody');
            tableBody.innerHTML = '';

            if (allProgramsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes available for assignment. Create programmes first.</td>
                    </tr>
                `;
            } else {
                allProgramsData.forEach(programme => {
                    const row = tableBody.insertRow();
                    row.classList.add('hover:bg-gray-50'); // No click for the row, only the button

                    const linkedCoursesNames = programme.linkedCourseIds.map(id => {
                        const course = allCoursesData.find(c => c.id === id);
                        return course ? course.name : 'Unknown Course';
                    }).join(', ') || 'None';

                    const assignedStudentsNames = programme.assignedStudentIds.map(id => {
                        const student = allUsersData.find(u => u.id === id);
                        return student ? `${student.name} ${student.surname}`.trim() : 'Unknown Student';
                    }).join(', ') || 'None';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${programme.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${linkedCoursesNames}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${assignedStudentsNames}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 assign-students-btn-trigger" data-programme-id="${programme.id}">Assign/View Students</button>
                        </td>
                    `;
                });
            }

            // Update programme counts for this specific table
            document.getElementById('assignProgrammesTotalCount').textContent = allProgramsData.length;
            document.getElementById('assignProgrammesShowingCount').textContent = allProgramsData.length > 0 ? 1 : 0;
            document.getElementById('assignProgrammesTotalCountDisplay').textContent = allProgramsData.length;

            // Add event listeners for "Assign/View Students" buttons in this new table
            document.querySelectorAll('.assign-students-btn-trigger').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent row click event if table rows were clickable
                    const programmeId = parseInt(this.dataset.programmeId);
                    showAssignStudentsModal(programmeId);
                });
            });
        }

        // System Settings Logic
        const systemLogoPreview = document.getElementById('systemLogoPreview');
        const systemLogoInput = document.getElementById('systemLogoInput');
        const generalSettingsForm = document.getElementById('generalSettingsForm');
        const systemNameInput = document.getElementById('systemNameInput');
        const defaultTimezoneSelect = document.getElementById('defaultTimezoneSelect');
        const systemLanguageSelect = document.getElementById('systemLanguageSelect');

        // Initial system settings data (can be loaded from localStorage in a real app)
        let systemSettings = {
            systemName: 'SKILLSCONNECT LMS',
            systemLogo: 'https://placehold.co/96x96/ADD8E6/00008B?text=LMS',
            defaultTimezone: 'UTC+2',
            systemLanguage: 'en'
        };

        // Function to load settings into the form
        function loadSystemSettings() {
            systemNameInput.value = systemSettings.systemName;
            systemLogoPreview.src = systemSettings.systemLogo;
            defaultTimezoneSelect.value = systemSettings.defaultTimezone;
            systemLanguageSelect.value = systemSettings.systemLanguage;
        }

        // Handle system logo preview
        systemLogoInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemLogoPreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                systemLogoPreview.src = "https://placehold.co/96x96/ADD8E6/00008B?text=LMS"; // Reset to placeholder
            }
        });

        // Handle form submission for general settings
        generalSettingsForm.addEventListener('submit', function(e) {
            e.preventDefault();

            systemSettings.systemName = systemNameInput.value.trim();
            // Store the base64 or URL for the logo if it's new
            systemSettings.systemLogo = systemLogoPreview.src; 
            systemSettings.defaultTimezone = defaultTimezoneSelect.value;
            systemSettings.systemLanguage = systemLanguageSelect.value;

            // Update logo in sidebar and top nav if they exist
            document.querySelectorAll('.fas.fa-graduation-cap.text-2xl.mr-3').forEach(icon => {
                 // Replace original logo icon with image if a custom logo is set
                if (systemSettings.systemLogo !== "https://placehold.co/96x96/ADD8E6/00008B?text=LMS") { // Check if it's not the default placeholder
                    const img = document.createElement('img');
                    img.src = systemSettings.systemLogo;
                    img.classList.add('h-8', 'w-8', 'rounded-full', 'mr-3', 'object-cover');
                    icon.replaceWith(img);
                }
            });


            showMessageModal('Settings Saved', 'General LMS settings have been updated.');
        });

        // Profile Settings Logic
        const profileSettingsForm = document.getElementById('profileSettingsForm');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const profilePictureInput = document.getElementById('profilePictureInput');
        const profileFullNameInput = document.getElementById('profileFullNameInput');
        const profileEmailInput = document.getElementById('profileEmailInput');
        const profileContactInput = document.getElementById('profileContactInput');
        const profileAddressInput = document.getElementById('profileAddressInput');
        const profilePasswordInput = document.getElementById('profilePasswordInput');

        // Function to load profile settings into the form
        function loadProfileSettings() {
            profileFullNameInput.value = loggedInUser.fullName;
            profileEmailInput.value = loggedInUser.email;
            profileContactInput.value = loggedInUser.contact || '';
            profileAddressInput.value = loggedInUser.address || '';
            profilePicturePreview.src = loggedInUser.picture;
            profilePasswordInput.value = ''; // Never pre-fill password fields
        }

        // Handle profile picture preview
        profilePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profilePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                profilePicturePreview.src = loggedInUser.picture; // Revert to current user picture
            }
        });

        // Handle profile settings form submission
        profileSettingsForm.addEventListener('submit', function(e) {
            e.preventDefault();

            loggedInUser.fullName = profileFullNameInput.value.trim();
            loggedInUser.email = profileEmailInput.value.trim();
            loggedInUser.contact = profileContactInput.value.trim();
            loggedInUser.address = profileAddressInput.value.trim();
            loggedInUser.picture = profilePicturePreview.src; // Update with new picture if uploaded

            // Find the user in allUsersData and update their properties
            const userIndex = allUsersData.findIndex(u => u.id === loggedInUser.id);
            if (userIndex !== -1) {
                // Ensure name and surname are updated correctly from fullName
                const nameParts = loggedInUser.fullName.split(' ');
                allUsersData[userIndex].name = nameParts[0] || '';
                allUsersData[userIndex].surname = nameParts.slice(1).join(' ') || ''; // Join remaining parts for surname
                allUsersData[userIndex].email = loggedInUser.email;
                // Don't update ID number or role here, as they are not editable via profile
                allUsersData[userIndex].picture = loggedInUser.picture;
                // Add contact and address fields to user object if they exist
                allUsersData[userIndex].contact = loggedInUser.contact;
                allUsersData[userIndex].address = loggedInUser.address;
            }

            if (profilePasswordInput.value.trim() !== '') {
                // In a real app, this would hash and save the new password
                // For simulation, just acknowledge it
                showMessageModal('Password Updated', 'Your password has been changed.');
                profilePasswordInput.value = ''; // Clear password field after change
            }
            
            // Update sidebar and top nav user info in case full name or picture changed
            document.getElementById('sidebarUsername').textContent = loggedInUser.fullName;
            document.getElementById('topNavUsername').textContent = loggedInUser.fullName;
            document.querySelector('#sidebar .user-info img').src = loggedInUser.picture;
            document.querySelector('header .dropdown img').src = loggedInUser.picture;


            showMessageModal('Profile Updated', 'Your personal information has been saved successfully.');
        });

        // Function to update dashboard statistics
        function updateDashboardStats() {
            const totalCoursesElement = document.getElementById('totalCourses');
            const totalStudentsElement = document.getElementById('totalStudents');

            if (totalCoursesElement) {
                totalCoursesElement.textContent = allCoursesData.length;
            }
            if (totalStudentsElement) {
                const studentsCount = allUsersData.filter(user => user.role === 'student').length;
                totalStudentsElement.textContent = studentsCount;
            }
        }

        // Reports Section Logic
        const reportGenerationForm = document.getElementById('reportGenerationForm');
        const reportCourseSelect = document.getElementById('reportCourseSelect');
        const reportResultsTableBody = document.getElementById('reportResultsTableBody');

        // Populate course select dropdown for reports
        function populateReportCourseSelect() {
            reportCourseSelect.innerHTML = '<option value="all">All Courses</option>'; // Always have "All Courses"
            allCoursesData.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = course.name;
                reportCourseSelect.appendChild(option);
            });
        }

        // Generate Report Function
        reportGenerationForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const userStatusFilter = document.getElementById('reportUserStatus').value;
            const courseFilterId = document.getElementById('reportCourseSelect').value; // Keep as string for 'all'

            let filteredUsers = allUsersData;

            // Apply User Status/Role Filter
            if (userStatusFilter !== 'all') {
                if (userStatusFilter === 'active' || userStatusFilter === 'deactivated') {
                    filteredUsers = filteredUsers.filter(user => user.status === userStatusFilter);
                } else { // Specific role (student, training_manager, administrator)
                    filteredUsers = filteredUsers.filter(user => user.role === userStatusFilter);
                }
            }

            // Apply Date Range Filter (Enrollment Date)
            if (startDate) {
                filteredUsers = filteredUsers.filter(user => user.enrollmentDate && new Date(user.enrollmentDate) >= new Date(startDate));
            }
            if (endDate) {
                filteredUsers = filteredUsers.filter(user => user.enrollmentDate && new Date(user.enrollmentDate) <= new Date(endDate));
            }

            // Render Report Results
            reportResultsTableBody.innerHTML = ''; // Clear previous results

            let displayedRowCount = 0;

            filteredUsers.forEach(user => {
                let enrolledCoursesNames = [];
                let completedCoursesNames = [];
                let userTotalHours = 0;

                // Process courses for students
                if (user.role === 'student' && user.coursesEnrolled && user.coursesEnrolled.length > 0) {
                    user.coursesEnrolled.forEach(enrollment => {
                        const course = allCoursesData.find(c => c.id === enrollment.courseId);
                        if (course) {
                            // Apply course filter
                            if (courseFilterId === 'all' || enrollment.courseId === parseInt(courseFilterId)) {
                                enrolledCoursesNames.push(course.name);
                                userTotalHours += (enrollment.hoursSpent || 0); // Sum hours spent
                                if (enrollment.completionDate) {
                                    completedCoursesNames.push(course.name);
                                }
                            }
                        }
                    });
                }
                
                // If a specific course is filtered and this user (if student) is not enrolled in it, skip.
                // Or if it's a non-student and a course filter is applied, skip.
                if (courseFilterId !== 'all' && user.role === 'student' && !enrolledCoursesNames.length) {
                    return; // Skip this student if they are not associated with the filtered course
                }
                if (courseFilterId !== 'all' && user.role !== 'student') {
                    return; // Skip non-students if a specific course is filtered
                }

                // For non-students, courses/hours are N/A
                const displayEnrolledCourses = user.role === 'student' ? (enrolledCoursesNames.length > 0 ? enrolledCoursesNames.join(', ') : 'None') : 'N/A';
                const displayCompletedCourses = user.role === 'student' ? (completedCoursesNames.length > 0 ? completedCoursesNames.join(', ') : 'None') : 'N/A';
                const displayHoursSpent = user.role === 'student' ? userTotalHours : 'N/A';
                const userEndDate = user.endDate || 'N/A';

                const newRow = reportResultsTableBody.insertRow();
                newRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.name} ${user.surname}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.idNumber}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500 max-w-xs overflow-hidden text-ellipsis">${displayEnrolledCourses}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500 max-w-xs overflow-hidden text-ellipsis">${displayCompletedCourses}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${displayHoursSpent}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.enrollmentDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${userEndDate}</td>
                `;
                displayedRowCount++;
            });

            document.getElementById('reportTotalCount').textContent = displayedRowCount;
            document.getElementById('reportShowingCount').textContent = displayedRowCount > 0 ? 1 : 0;
            document.getElementById('reportTotalCountDisplay').textContent = displayedRowCount;

            if (displayedRowCount === 0) {
                reportResultsTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No data found matching your criteria.</td>
                    </tr>
                `;
            }

            showMessageModal('Report Generated', `Report for ${displayedRowCount} entries has been generated.`);
        });

        // Messages Section Email Composition Logic
        const emailRecipientSelect = document.getElementById('emailRecipientSelect');
        const emailSubjectInput = document.getElementById('emailSubjectInput');
        const emailBodyTextarea = document.getElementById('emailBodyTextarea');
        const composeEmailForm = document.getElementById('composeEmailForm');

        function populateStudentEmailDropdown() {
            emailRecipientSelect.innerHTML = '<option value="">Select a student</option>'; // Clear existing and add default
            const students = allUsersData.filter(user => user.role === 'student' && user.status === 'active'); // Only active students

            if (students.length === 0) {
                // Optionally display a message if no students are available
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No active students available";
                option.disabled = true;
                emailRecipientSelect.appendChild(option);
            } else {
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.email;
                    option.textContent = `${student.name} ${student.surname || ''} (${student.email})`;
                    emailRecipientSelect.appendChild(option);
                });
            }
        }

        composeEmailForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const recipientEmail = emailRecipientSelect.value;
            const recipientName = emailRecipientSelect.options[emailRecipientSelect.selectedIndex].textContent;
            const subject = emailSubjectInput.value.trim();
            const messageBody = emailBodyTextarea.value.trim();

            if (!recipientEmail) {
                showMessageModal('Input Error', 'Please select a student recipient.');
                return;
            }
            if (!subject) {
                showMessageModal('Input Error', 'Please enter a subject for the email.');
                return;
            }
            if (!messageBody) {
                showMessageModal('Input Error', 'Please write your message before sending.');
                return;
            }

            const confirmationMessage = `Simulated Email Sent!\n\nTo: ${recipientName}\nSubject: ${subject}\n\nMessage:\n"${messageBody}"\n\nIn a real application, this email would be sent to the student's email address.`;

            showMessageModal('Email Sent', confirmationMessage);
            
            // Clear the form after successful submission
            composeEmailForm.reset();
        });

        // Event delegation for "Assign Students" buttons in the existing programmes table
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('assign-students-btn')) {
                e.stopPropagation(); // Prevent row click event
                const programmeId = parseInt(e.target.dataset.programmeId);
                showAssignStudentsModal(programmeId);
            }
        });

    </script>
</body>
</html>
